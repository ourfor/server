#
# MDEV-32898 Phantom rows caused by updates of PRIMARY KEY
#
CREATE TABLE t(a INT PRIMARY KEY, b INT) ENGINE=InnoDB;
INSERT INTO t VALUES (1,1),(2,2);
connect con1,localhost,root;
BEGIN;
SELECT * FROM t LOCK IN SHARE MODE;
a	b
1	1
2	2
connection default;
BEGIN;
SELECT * FROM t;
a	b
1	1
2	2
connection con1;
UPDATE t SET a=3 WHERE b=2;
COMMIT;
disconnect con1;
connection default;
UPDATE t SET b=3;
ERROR 40001: Deadlock found when trying to get lock; try restarting transaction
SELECT * FROM t;
a	b
1	1
3	2
COMMIT;
DROP TABLE t;
